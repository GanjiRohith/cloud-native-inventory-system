<!DOCTYPE html>
<html>
<head>

<title>Login / Register</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body class="bg-light">

<div class="container mt-5">

<h3>Login / Register</h3>

<input id="name" class="form-control mb-2" placeholder="Name">

<input id="email" class="form-control mb-2" placeholder="Email">

<input id="password" type="password"
class="form-control mb-2"
placeholder="Password">

<select id="role" class="form-control mb-3">
<option value="user">User</option>
<option value="admin">Admin</option>
</select>

<button class="btn btn-success" onclick="registerUser()">Register</button>

<button class="btn btn-primary" onclick="loginUser()">Login</button>

</div>

<script>

async function registerUser(){

let res = await fetch("/register",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
name:document.getElementById("name").value,
email:document.getElementById("email").value,
password:document.getElementById("password").value,
role:document.getElementById("role").value,
db:localStorage.getItem("db")
})
});

let data = await res.json();
alert(JSON.stringify(data));
}


async function loginUser(){

let res = await fetch("/login",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
email:document.getElementById("email").value,
password:document.getElementById("password").value,
db:localStorage.getItem("db")
})
});

let data = await res.json();

if(data.error){
alert(data.error);
return;
}

localStorage.setItem("user_id",data.id);
localStorage.setItem("role",data.role);

if(data.role==="admin")
window.location.href="/admin.html";
else
window.location.href="/user.html";
}

</script>

</body>
</html>