<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard</title>

<link
href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
rel="stylesheet"
/>

</head>

<body class="container mt-5">

<h2 class="mb-4">Admin Dashboard</h2>

<hr>

<!-- ================= ADD PRODUCT ================= -->

<h4>Add Product</h4>

<input id="pname"
class="form-control mb-2"
placeholder="Product Name">

<input id="price"
class="form-control mb-2"
placeholder="Price">

<input id="qty"
class="form-control mb-2"
placeholder="Quantity">

<button
onclick="addProduct()"
class="btn btn-success mb-4">
Add Product
</button>

<hr>

<!-- ================= ACTION BUTTONS ================= -->

<button
class="btn btn-primary me-2"
onclick="loadProducts()">
View Inventory
</button>

<button
class="btn btn-warning me-2"
onclick="loadOrders()">
View Orders
</button>

<button
class="btn btn-danger"
onclick="logout()">
Logout
</button>

<hr>

<!-- ================= TABLE ================= -->

<table class="table table-bordered mt-4">

<thead class="table-dark">
<tr>
<th>ID</th>
<th>Name</th>
<th>Price</th>
<th>Stock</th>
</tr>
</thead>

<tbody id="tableBody"></tbody>

</table>

<script>

const db = localStorage.getItem("db");

/* ================= ADD PRODUCT ================= */

async function addProduct(){

let res = await fetch("/products",{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
name:document.getElementById("pname").value,
price:Number(document.getElementById("price").value),
quantity:Number(document.getElementById("qty").value),
db:db
})
});

let data = await res.json();

alert(JSON.stringify(data));

loadProducts();
}


/* ================= LOAD INVENTORY ================= */

async function loadProducts(){

let res = await fetch(`/products?db=${db}`);
let products = await res.json();

let html="";

products.forEach(p=>{

html+=`
<tr>
<td>${p.id}</td>
<td>${p.name}</td>
<td>${p.price}</td>
<td>${p.quantity}</td>
</tr>
`;

});

document.getElementById("tableBody").innerHTML=html;
}


/* ================= LOAD ORDERS ================= */

async function loadOrders(){

let res = await fetch(`/orders?db=${db}`);
let orders = await res.json();

let html="";

orders.forEach(o=>{

html+=`
<tr>
<td>${o.id}</td>
<td>User ${o.user_id}</td>
<td>Product ${o.product_id}</td>
<td>${o.quantity}</td>
</tr>
`;

});

document.getElementById("tableBody").innerHTML=html;
}


/* ================= LOGOUT ================= */

function logout(){

localStorage.clear();
window.location.href="/";
}

</script>

</body>
</html>